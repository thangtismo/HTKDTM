{% extends "base.html" %}
{% block content %}
<div class="bg-white p-6 rounded-2xl shadow-md">
    <div class="flex items-center justify-between mb-6">
        <h2 class="text-2xl font-bold text-green-700">‚úèÔ∏è Ch·ªânh s·ª≠a m√πa v·ª•</h2>
        <a href="{{ url_for('manage') }}" class="text-gray-600 hover:text-gray-800 text-sm bg-gray-100 hover:bg-gray-200 px-4 py-2 rounded-lg transition duration-200">
            ‚Üê Quay l·∫°i
        </a>
    </div>
    
    <form method="POST" class="grid grid-cols-1 md:grid-cols-2 gap-6">
        <!-- T√™n n√¥ng d√¢n -->
        <div class="space-y-2">
            <label class="text-sm font-medium text-gray-700">T√™n n√¥ng d√¢n *</label>
            <input type="text" name="farmer_name" value="{{ season.farmer_name or '' }}" 
                   class="w-full border border-gray-300 rounded-lg px-3 py-2 focus:outline-none focus:ring-2 focus:ring-green-500 focus:border-transparent" 
                   placeholder="Nh·∫≠p t√™n n√¥ng d√¢n" required>
        </div>

        <!-- T·ªânh th√†nh -->
        <div class="space-y-2">
            <label class="text-sm font-medium text-gray-700">T·ªânh th√†nh *</label>
            <select name="province" class="w-full border border-gray-300 rounded-lg px-3 py-2 focus:outline-none focus:ring-2 focus:ring-green-500 focus:border-transparent" required>
                <option value="">-- Ch·ªçn t·ªânh --</option>
                {% for p in provinces %}
                <option value="{{ p }}" {% if p == season.province %}selected{% endif %}>{{ p }}</option>
                {% endfor %}
            </select>
        </div>

        <!-- C√¢y tr·ªìng -->
        <div class="space-y-2">
            <label class="text-sm font-medium text-gray-700">C√¢y tr·ªìng *</label>
            <input type="text" name="crop" value="{{ season.crop or '' }}" 
                   class="w-full border border-gray-300 rounded-lg px-3 py-2 focus:outline-none focus:ring-2 focus:ring-green-500 focus:border-transparent" 
                   placeholder="V√≠ d·ª•: L√∫a, Ng√¥, C√† ph√™..." required>
        </div>

        <!-- Di·ªán t√≠ch -->
        <div class="space-y-2">
            <label class="text-sm font-medium text-gray-700">Di·ªán t√≠ch (ha) *</label>
            <input type="number" name="area" value="{{ season.area or '0' }}" step="0.01" min="0.01" 
                   class="w-full border border-gray-300 rounded-lg px-3 py-2 focus:outline-none focus:ring-2 focus:ring-green-500 focus:border-transparent" 
                   placeholder="0.00" required>
        </div>

        <!-- Ng√†y gieo tr·ªìng -->
        <div class="space-y-2 md:col-span-2">
            <label class="text-sm font-medium text-gray-700">Ng√†y gieo tr·ªìng *</label>
            <input type="date" name="sow_date" value="{{ season.sow_date or '' }}" 
                   class="w-full border border-gray-300 rounded-lg px-3 py-2 focus:outline-none focus:ring-2 focus:ring-green-500 focus:border-transparent" required>
        </div>

        <!-- Ng√†y thu ho·∫°ch -->
        <div class="space-y-2 md:col-span-2">
            <label class="text-sm font-medium text-gray-700">Ng√†y d·ª± ki·∫øn thu ho·∫°ch *</label>
            <input type="date" name="harvest_date" value="{{ season.harvest_date or '' }}" 
                   class="w-full border border-gray-300 rounded-lg px-3 py-2 focus:outline-none focus:ring-2 focus:ring-green-500 focus:border-transparent" required>
        </div>

        <!-- Ph√¢n b√≥n -->
        <div class="space-y-2 md:col-span-2">
            <label class="text-sm font-medium text-gray-700">Ph√¢n b√≥n s·ª≠ d·ª•ng</label>
            <input type="text" name="fertilizer" value="{{ season.fertilizer or '' }}" 
                   class="w-full border border-gray-300 rounded-lg px-3 py-2 focus:outline-none focus:ring-2 focus:ring-green-500 focus:border-transparent" 
                   placeholder="V√≠ d·ª•: NPK, Ph√¢n h·ªØu c∆°, Ph√¢n chu·ªìng...">
        </div>

        <!-- Ghi ch√∫ -->
        <div class="space-y-2 md:col-span-2">
            <label class="text-sm font-medium text-gray-700">Ghi ch√∫</label>
            <textarea name="notes" rows="4" 
                      class="w-full border border-gray-300 rounded-lg px-3 py-2 focus:outline-none focus:ring-2 focus:ring-green-500 focus:border-transparent" 
                      placeholder="Ghi ch√∫ th√™m v·ªÅ m√πa v·ª•...">{{ season.notes or '' }}</textarea>
        </div>

        <!-- N√∫t h√†nh ƒë·ªông -->
        <div class="md:col-span-2 flex flex-col sm:flex-row gap-4 pt-4">
            <button type="submit" 
                    class="flex-1 bg-green-600 hover:bg-green-700 text-white py-3 rounded-lg font-medium transition duration-200 flex items-center justify-center gap-2">
                <span>üíæ</span>
                L∆∞u thay ƒë·ªïi
            </button>
            <a href="{{ url_for('manage') }}" 
               class="flex-1 bg-gray-500 hover:bg-gray-600 text-white py-3 rounded-lg font-medium transition duration-200 text-center flex items-center justify-center gap-2">
                <span>‚Ü∂</span>
                H·ªßy b·ªè
            </a>
        </div>
    </form>

    <!-- Th√¥ng tin hi·ªán t·∫°i -->
    <div class="mt-8 p-4 bg-blue-50 border border-blue-200 rounded-lg">
        <h3 class="text-sm font-medium text-blue-800 mb-2">üí° L∆∞u √Ω khi ch·ªânh s·ª≠a</h3>
        <ul class="text-sm text-blue-700 space-y-1">
            <li>‚Ä¢ Thay ƒë·ªïi th√¥ng tin s·∫Ω c·∫≠p nh·∫≠t ngay v√†o h·ªá th·ªëng</li>
            <li>‚Ä¢ N·∫øu thay ƒë·ªïi di·ªán t√≠ch ho·∫∑c c√¢y tr·ªìng, nƒÉng su·∫•t c√≥ th·ªÉ thay ƒë·ªïi</li>
            <li>‚Ä¢ Ng√†y gieo tr·ªìng v√† thu ho·∫°ch ·∫£nh h∆∞·ªüng ƒë·∫øn t√≠nh to√°n th·ªùi gian sinh tr∆∞·ªüng</li>
            <li>‚Ä¢ Th√¥ng tin ph√¢n b√≥n gi√∫p h·ªá th·ªëng ƒë∆∞a ra khuy·∫øn ngh·ªã ch√≠nh x√°c h∆°n</li>
        </ul>
    </div>
</div>

<!-- Hi·ªÉn th·ªã th√¥ng b√°o l·ªói n·∫øu c√≥ -->
{% with messages = get_flashed_messages(with_categories=true) %}
    {% if messages %}
        <div class="mt-6 space-y-2">
            {% for category, message in messages %}
                <div class="p-4 rounded-lg {% if category == 'success' %}bg-green-100 text-green-700 border border-green-200{% elif category == 'error' %}bg-red-100 text-red-700 border border-red-200{% else %}bg-blue-100 text-blue-700 border border-blue-200{% endif %}">
                    {{ message }}
                </div>
            {% endfor %}
        </div>
    {% endif %}
{% endwith %}

<style>
    /* T√πy ch·ªânh th√™m */
    input:focus, select:focus, textarea:focus {
        transform: translateY(-1px);
        box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1), 0 2px 4px -1px rgba(0, 0, 0, 0.06);
    }
    
    .transition {
        transition: all 0.2s ease-in-out;
    }
</style>

<script>
    // JavaScript ƒë·ªÉ c·∫£i thi·ªán tr·∫£i nghi·ªám ng∆∞·ªùi d√πng
    document.addEventListener('DOMContentLoaded', function() {
        // T·ª± ƒë·ªông t√≠nh to√°n s·ªë ng√†y sinh tr∆∞·ªüng khi thay ƒë·ªïi ng√†y
        const sowDateInput = document.querySelector('input[name="sow_date"]');
        const harvestDateInput = document.querySelector('input[name="harvest_date"]');
        
        function calculateGrowthDays() {
            if (sowDateInput.value && harvestDateInput.value) {
                const sowDate = new Date(sowDateInput.value);
                const harvestDate = new Date(harvestDateInput.value);
                const diffTime = Math.abs(harvestDate - sowDate);
                const diffDays = Math.ceil(diffTime / (1000 * 60 * 60 * 24));
                
                // Hi·ªÉn th·ªã th√¥ng tin s·ªë ng√†y
                if (diffDays > 0) {
                    const existingInfo = document.querySelector('.growth-days-info');
                    if (existingInfo) {
                        existingInfo.remove();
                    }
                    
                    const infoDiv = document.createElement('div');
                    infoDiv.className = 'growth-days-info mt-2 p-2 bg-yellow-50 border border-yellow-200 rounded text-sm text-yellow-700';
                    infoDiv.innerHTML = `üìÖ Th·ªùi gian sinh tr∆∞·ªüng d·ª± ki·∫øn: <strong>${diffDays} ng√†y</strong>`;
                    
                    harvestDateInput.parentNode.appendChild(infoDiv);
                }
            }
        }
        
        sowDateInput.addEventListener('change', calculateGrowthDays);
        harvestDateInput.addEventListener('change', calculateGrowthDays);
        
        // T√≠nh to√°n ban ƒë·∫ßu n·∫øu c√≥ gi√° tr·ªã
        calculateGrowthDays();
    });
</script>
{% endblock %}